<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Code A Minimalistic NFT Smart Contract in Solidity On Ethereum: A How-To Guide | Hacker Noon</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Code A Minimalistic NFT Smart Contract in Solidity On Ethereum: A How-To Guide | Hacker Noon</h1>
</header>
<section data-field="subtitle" class="p-summary">
NFT is a new/old buzzword of the blockchain world. The NFT standard ( EIP-721) was created in 2018, but after CrptoKitties this field was…
</section>
<section data-field="body" class="e-content">
<section name="b973" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="9da6" id="9da6" class="graf graf--h3 graf--leading graf--title">Code A Minimalistic NFT Smart Contract in Solidity On Ethereum: A How-To Guide</h3><figure name="22be" id="22be" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="0*rOwITaR_U0Ute-OP" data-width="700" data-height="700" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*rOwITaR_U0Ute-OP"></figure><p name="c940" id="c940" class="graf graf--p graf-after--figure">NFT is a new/old buzzword of the blockchain world. The NFT standard ( <a href="https://eips.ethereum.org/EIPS/eip-721?ref=hackernoon.com" data-href="https://eips.ethereum.org/EIPS/eip-721?ref=hackernoon.com" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">EIP-721</a>) was created in 2018, but after CrptoKitties this field was relatively silent.</p><p name="40a2" id="40a2" class="graf graf--p graf-after--p">Nowadays NFTs are back in fashion, and everybody wants to make NFT from everything. You can sell your arts or tweets, or anything that you can imagine in form of NFTs. But what is this mystic NFT thing?</p><p name="c0e1" id="c0e1" class="graf graf--p graf-after--p">NFT is not a big deal. As <a href="https://eips.ethereum.org/EIPS/eip-20?ref=hackernoon.com" data-href="https://eips.ethereum.org/EIPS/eip-20?ref=hackernoon.com" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">ERC20</a> (fungible) tokens, NFT (non-fungible tokens) are also simple “databases” on the blockchain.</p><p name="a83e" id="a83e" class="graf graf--p graf-after--p">While an ERC20 token contract stores balances of Ethereum addresses, the NFT contract stores unique ID -&gt; Ethereum address assignments. When you mint an NFT to yourself, the token contract assigns the unique token ID to your Ethereum address.</p><blockquote name="a6cb" id="a6cb" class="graf graf--blockquote graf-after--p"><em class="markup--em markup--blockquote-em">Technically this unique ID is the NFT itself.</em></blockquote><p name="1d7b" id="1d7b" class="graf graf--p graf-after--blockquote">You can sell it, or buy other NFTs which is a reassignment of the ID. Metadata can be assigned to the ID (by a URI) that represents the thing behind the NFT (ex.: an image, a tweet, etc.). That’s all. Easy, right? I told, NFT is not a big deal…</p><p name="d76e" id="d76e" class="graf graf--p graf-after--p">Although an NFT is not a complicated thing, an NFT contract can be quite complex. If you take a look at <a href="https://github.com/0xcert/ethereum-erc721?ref=hackernoon.com" data-href="https://github.com/0xcert/ethereum-erc721?ref=hackernoon.com" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">0xcert’s implementation</a>, you will find a complex token logic and many internal state variables.</p><p name="8ae6" id="8ae6" class="graf graf--p graf-after--p">The problem with complexity is the high transaction cost. In this article, I will show how can you create a minimalistic but fully functional NFT contract on the Ethereum blockchain.</p><p name="2b65" id="2b65" class="graf graf--p graf-after--p">First of all, take a look at some of the state variables of 0xcert’s implementation:</p><pre name="ed50" id="ed50" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">mapping (address =&gt; uint256[]) internal ownerToIds;<br>mapping (uint256 =&gt; uint256) internal idToOwnerIndex;<br>mapping (uint256 =&gt; address) internal idToOwner;<br>mapping (address =&gt; uint256) private ownerToNFTokenCount;</code> </pre><p name="62b1" id="62b1" class="graf graf--p graf-after--pre">The<code class="markup--code markup--p-code">ownerToIds</code> mapping contains the token IDs that are assigned to the Ethereum address,<code class="markup--code markup--p-code">idToOwner</code>is a token ID -&gt; Ethereum address mapping,<code class="markup--code markup--p-code">idToOwnerIndex</code>assigns the token ID to the index of the owner’s token array, and finally,<code class="markup--code markup--p-code">ownerToNFTokenCount</code>assigns the owner Ethereum address to the token count (how many NFT are owned by the owner).</p><blockquote name="e74b" id="e74b" class="graf graf--blockquote graf-after--p"><em class="markup--em markup--blockquote-em">As you see, this data structure is strongly redundant, because every mapping could be calculated from the first ownerToIds structure.</em></blockquote><p name="2d95" id="2d95" class="graf graf--p graf-after--blockquote">All of these mappings are stored on the blockchain, and all of them have to be managed in the contract’s methods. Unfortunately, all of them are needed if we want to implement the ERC-721 token standard. So, what we can do to reduce the complexity and the transactional cost of method calls?</p><p name="05ff" id="05ff" class="graf graf--p graf-after--p">If ERC-721 compatibility is not needed then we can do a simple trick. In this case, we can store on the blockchain only the things that are absolutely necessary.</p><p name="76dc" id="76dc" class="graf graf--p graf-after--p">Every other thing can be stored in an external database. If we store the token balances, token lists, etc. in an external (non-blockchain) storage then we don’t need the redundant mappings. The contract will be simpler and the transactions will be cheaper. After the theory, let’s take a look at the code:</p><figure name="1acd" id="1acd" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/TheBojda/9fb22e3ecc8258b1f77b2846ee37ced6.js"></script></figure><p name="b666" id="b666" class="graf graf--p graf-after--figure">Only 24 lines of code. Not bad. But is it really a fully functional NFT contract? Let’s see. It has 2 methods: mint and transfer. The mint method creates a new NFT token. It has 2 parameters<code class="markup--code markup--p-code">_to</code>and<code class="markup--code markup--p-code">_ipfsHash</code>. The first parameter is the target Ethereum address that will own the newly minted token. The first parameter is the target Ethereum address that will own the newly minted token.</p><p name="860f" id="860f" class="graf graf--p graf-after--p">The second parameter is a unique hash that points to the metadata on <a href="https://ipfs.io/?ref=hackernoon.com" data-href="https://ipfs.io/?ref=hackernoon.com" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">IPFS</a>. In the original ERC-721 specification metadata is pointed by a<code class="markup--code markup--p-code">tokenURI</code>. Why do we use an IPFS hash instead? There are many reasons.</p><p name="9a15" id="9a15" class="graf graf--p graf-after--p">An IPFS hash is only 32 bytes, so writing it to the blockchain is cheaper than a URI string. The second reason is that IPFS is immutable. The content cannot be changed, because if it changes the IPFS hash would also change. So, storing the data on IPFS and writing the hash to the blockchain is something like writing the data itself to the blockchain, but much cheaper.</p><p name="1951" id="1951" class="graf graf--p graf-after--p">The <strong class="markup--strong markup--p-strong">mint</strong> method reads the current value of the<code class="markup--code markup--p-code">tokenCounter</code>variable to get a unique token ID. The method increments this variable by every call, so the token ID will be absolutely unique. The method stores the token ID — Ethereum address assignment into the<code class="markup--code markup--p-code">idToOwner</code>mapping, which is the only one mapping what we store on the blockchain. In the last step, the method emits a Mint event, which will be very important later.</p><p name="eb8c" id="eb8c" class="graf graf--p graf-after--p">The <strong class="markup--strong markup--p-strong">transfer</strong> method has two parameters<code class="markup--code markup--p-code">_to</code>and<code class="markup--code markup--p-code">_tokenId</code>. The first parameter is the target address that will own the NFT, and the second parameter is the ID of the token. The first line of the method checks the ownership of the token using the<code class="markup--code markup--p-code">idToOwner</code>mapping. Only the token owner can call the transfer method. If the token is owned by the caller, then the method modifies the assignment in the mapping and emits a Transfer event.</p><p name="7a18" id="7a18" class="graf graf--p graf-after--p">This two method is enough for a fully functional NFT. But what about the balances, ownership queries, etc.? Here comes the external database. When a contract emits an <a href="https://docs.soliditylang.org/en/latest/contracts.html?ref=hackernoon.com#events" data-href="https://docs.soliditylang.org/en/latest/contracts.html?ref=hackernoon.com#events" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">event</a>, it will be stored on the blockchain in the logs.</p><p name="93fc" id="93fc" class="graf graf--p graf-after--p">These logs are available through the <a href="https://eth.wiki/json-rpc/API?ref=hackernoon.com" data-href="https://eth.wiki/json-rpc/API?ref=hackernoon.com" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">JSON-RPC API</a> directly, or you can use the JavaScript API to read them. These logs contain the full transaction history, so they contain every piece of information that is needed. Since they are stored on the blockchain, at every point in time a database can be built from them that contains the token ownership, balances, and every other data that is needed.</p><p name="27d4" id="27d4" class="graf graf--p graf-after--p">To show this, let’s check the ERC-721 methods and how an external database can provide the data.</p><pre name="30c8" id="30c8" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">balanceOf</strong></code><strong class="markup--strong markup--pre-strong">,</strong><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">ownerOf </strong></code>- These can be easily calculated from Mint and Transfer events</pre><pre name="d598" id="d598" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">approve</strong></code><strong class="markup--strong markup--pre-strong">,</strong><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">setApprovalForAll</strong></code><strong class="markup--strong markup--pre-strong">,</strong><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">getApproved</strong></code><strong class="markup--strong markup--pre-strong">,</strong><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">isApprovedForAll </strong></code>- Our minimalistic NFT doesn’t provide approval logic, only the owner can transfer the tokens. If needed, this feature can be implemented by a second mapping.</pre><pre name="40ce" id="40ce" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">safeTransferFrom</strong></code><strong class="markup--strong markup--pre-strong">,</strong><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">transferFrom </strong></code>- Transfer safety can be checked externally, and from parameter is meaningless here, because our tokens can be transferred only by the owner.</pre><pre name="42ad" id="42ad" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">tokenURI</strong></code><strong class="markup--strong markup--pre-strong"> </strong>- The URI of the token can be generated from the IPFS hash part of the Mint event.</pre><pre name="525f" id="525f" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">totalSupply</strong></code><strong class="markup--strong markup--pre-strong">,</strong><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">tokenByIndex</strong></code><strong class="markup--strong markup--pre-strong">,</strong><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">tokenOfOwnerByIndex </strong></code>- These can be calculated easily from the Mint and Transfer events.</pre><p name="6ed7" id="6ed7" class="graf graf--p graf-after--pre">As you can see, our minimalistic NFT token can do everything that an ERC-721 token can do except the approval logic, but it can be implemented if needed.</p><p name="820e" id="820e" class="graf graf--p graf-after--p graf--trailing"><em class="markup--em markup--p-em">Originally published at </em><a href="https://hackernoon.com/code-a-minimalistic-nft-smart-contract-in-solidity-on-ethereum-a-how-to-guide-kl3u34l6" data-href="https://hackernoon.com/code-a-minimalistic-nft-smart-contract-in-solidity-on-ethereum-a-how-to-guide-kl3u34l6" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">https://hackernoon.com</em></a><em class="markup--em markup--p-em"> on May 22, 2021.</em></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@thebojda" class="p-author h-card">Laszlo Fazekas</a> on <a href="https://medium.com/p/5cb72f0891c"><time class="dt-published" datetime="2021-05-22T00:00:00.000Z">May 22, 2021</time></a>.</p><p><a href="https://medium.com/@thebojda/code-a-minimalistic-nft-smart-contract-in-solidity-on-ethereum-a-how-to-guide-hacker-noon-5cb72f0891c" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 18, 2021.</p></footer></article></body></html>
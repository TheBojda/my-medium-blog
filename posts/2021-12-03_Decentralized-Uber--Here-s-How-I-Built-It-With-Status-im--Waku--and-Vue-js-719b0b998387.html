<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Decentralized Uber: Here’s How I Built It With Status.im, Waku, and Vue.js</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Decentralized Uber: Here’s How I Built It With Status.im, Waku, and Vue.js</h1>
</header>
<section data-field="subtitle" class="p-summary">
Instead of putting the taxi driver out of a job, blockchain puts Uber out of a job and lets the taxi drivers work with the customer…
</section>
<section data-field="body" class="e-content">
<section name="a47c" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="82d8" id="82d8" class="graf graf--h3 graf--leading graf--title">Decentralized Uber: Here’s How I Built It With Status.im, Waku, and Vue.js</h3><figure name="c420" id="c420" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="0*LZGxeLTEBYE2F6QW" data-width="1880" data-height="1253" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*LZGxeLTEBYE2F6QW"></figure><blockquote name="c5f2" id="c5f2" class="graf graf--blockquote graf-after--figure">Instead of putting the taxi driver out of a job, blockchain puts Uber out of a job and lets the taxi drivers work with the customer directly. — Vitalik Buterin</blockquote><p name="15be" id="15be" class="graf graf--p graf-after--blockquote">When I first time read the above quote from Vitalik Buterin, I started to think about how to implement a decentralized Uber-like car-sharing application. Blockchain is expensive and not invented for storing temporary data like car positions. The answer is that not blockchain is the answer. We have to go deeper.</p><p name="c14c" id="c14c" class="graf graf--p graf-after--p">The basic mechanism of a p2p car-sharing app is that the passenger broadcasts a car request with her coordinates. The drivers get this request, and who has a free car, answers to it. The passenger receives the answer and chooses a driver. As you can see what we need is a messaging protocol with broadcast functionality. Something similar is used to broadcast the finished blocks in the blockchain network.</p><p name="c828" id="c828" class="graf graf--p graf-after--p">Ethereum has its own messaging protocol called <a href="https://eth.wiki/concepts/whisper/whisper" data-href="https://eth.wiki/concepts/whisper/whisper" class="markup--anchor markup--p-anchor" rel="noopener noreferrer nofollow noopener" target="_blank">Whisper</a>. Unfortunately, it is not really known and it is not supported by default in the Ethereum clients. Fortunately, there is a project called <a href="https://status.im/" data-href="https://status.im/" class="markup--anchor markup--p-anchor" rel="noopener noreferrer nofollow noopener" target="_blank">Status.im</a> that has a protocol called <a href="https://github.com/status-im/js-waku" data-href="https://github.com/status-im/js-waku" class="markup--anchor markup--p-anchor" rel="noopener noreferrer nofollow noopener" target="_blank">Waku</a> that replaces Whisper. Waku is based on <a href="https://libp2p.io/" data-href="https://libp2p.io/" class="markup--anchor markup--p-anchor" rel="noopener noreferrer nofollow noopener" target="_blank">libp2p</a> and supports topic messaging through <a href="https://docs.libp2p.io/concepts/publish-subscribe/" data-href="https://docs.libp2p.io/concepts/publish-subscribe/" class="markup--anchor markup--p-anchor" rel="noopener noreferrer nofollow noopener" target="_blank">gossipsub</a>, so it fully meets our needs. (I have <a href="https://hackernoon.com/writing-decentralized-applications-in-javascript-libp2p-basics" data-href="https://hackernoon.com/writing-decentralized-applications-in-javascript-libp2p-basics" class="markup--anchor markup--p-anchor" rel="noopener noreferrer nofollow noopener" target="_blank">an article about libp2p</a>. It’s recommended to read it to understand the basics.)</p><p name="5e7d" id="5e7d" class="graf graf--p graf-after--p">Now we have a basic concept and a pub/sub protocol. Let’s design a minimalistic UI for it. My minimalistic UI looks like this:</p><figure name="3778" id="3778" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*OjBwzrlmnThPFPBP.png" data-width="1080" data-height="1920" src="https://cdn-images-1.medium.com/max/800/0*OjBwzrlmnThPFPBP.png"></figure><p name="4474" id="4474" class="graf graf--p graf-after--figure">A simple google map with 3 buttons. The first button is the profile button. I’ve tried to find the easiest solution that is possible for profile management. <a href="https://gravatar.com/" data-href="https://gravatar.com/" class="markup--anchor markup--p-anchor" rel="noopener noreferrer nofollow noopener" target="_blank">Gravatar</a> is a simple general profile service where you can assign a profile image and some profile data to your e-mail address.</p><p name="4f2e" id="4f2e" class="graf graf--p graf-after--p">It’s used in many services like GitHub, WordPress, etc. and it can store basic profile data, so it will be good for us. On the profile panel, you have to give your e-mail address only, and the application will download all of your profile data from gravatar. It is important to set a phone number or a Skype account because your possible passengers can access you through it.</p><figure name="3198" id="3198" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*HryK64zagr5XD41d.png" data-width="1080" data-height="1920" src="https://cdn-images-1.medium.com/max/800/0*HryK64zagr5XD41d.png"></figure><p name="f10e" id="f10e" class="graf graf--p graf-after--figure">The second button is a toggle button for car sharing. If you click on it, the color of the button changes to green, and the app will subscribe to the broadcast topic. If an incoming call comes the app will show a blue marker. If you click on the marker, you can make an offer to the possible passenger.</p><figure name="23df" id="23df" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*hMtVKPWN-gRQ2pJw.png" data-width="1080" data-height="1920" src="https://cdn-images-1.medium.com/max/800/0*hMtVKPWN-gRQ2pJw.png"></figure><p name="45b9" id="45b9" class="graf graf--p graf-after--figure">The last button is for the passengers for calling a car. If a passenger clicks this button, the app will broadcast the request to the drivers. If a driver mak an offer, a green marker will be shown. The passenger can choose one of the drivers and he can call her using the given Skype account or phone number.</p><figure name="c8ea" id="c8ea" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*9y4_BL3mni8bF53j.png" data-width="1080" data-height="1920" src="https://cdn-images-1.medium.com/max/800/0*9y4_BL3mni8bF53j.png"></figure><p name="f7ef" id="f7ef" class="graf graf--p graf-after--figure">That’s all. As I wrote before. It is a fully minimal implementation of the conception. The aim of it is to help to understand how the p2p pub/sub system works under the app. Let’s look at the code.</p><p name="7274" id="7274" class="graf graf--p graf-after--p">Initializing Waku is really simple.</p><pre name="d313" id="d313" class="graf graf--pre graf-after--p">this.waku = await Waku.create({ bootstrap: true }); await this.waku.waitForConnectedPeer();</pre><p name="c9b2" id="c9b2" class="graf graf--p graf-after--pre">These 2 lines of code will download the actual list of Waku bootstrap nodes and wait for some peers to be connected. After this initialization, our application will be a part of the Gossipsub mesh, and ready to send and receive messages.</p><pre name="7f3b" id="7f3b" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">let privateTopicName = &quot;/waku-uber/1/&quot; + parsedAvatarData.hash + &quot;/proto&quot;;</code></pre><pre name="f119" id="f119" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">this.waku.relay.addObserver(<br>  (wakuMessage) =&gt; {<br>    this.processPrivateMessage(wakuMessage);<br>  },<br>  [privateTopicName]<br>);</code></pre><p name="81ea" id="81ea" class="graf graf--p graf-after--pre">Every client subscribes to a special private topic that is generated from the e-mail hash to make it unique. The app will use this topic when a driver makes an offer to a possible passenger. The subscription is done by <code class="markup--code markup--p-code">waku.relay.addObserver</code>. The topic name can be anything, but <a href="https://github.com/status-im/js-waku/blob/main/guides/choose-content-topic.md" data-href="https://github.com/status-im/js-waku/blob/main/guides/choose-content-topic.md" class="markup--anchor markup--p-anchor" rel="noopener noreferrer nofollow noopener" target="_blank">Waku has a recommendation</a> for the topic name format.</p><pre name="7e61" id="7e61" class="graf graf--pre graf-after--p">const payload = proto.WakuUberMessage.encode({ <br>  type: proto.Type.REQUEST, <br>  lat: this.myPosition.lat, <br>  lng: this.myPosition.lng, <br>  avatarHash: parsedAvatarData.hash, <br>}); </pre><pre name="9932" id="9932" class="graf graf--pre graf-after--pre">const wakuMessage = await WakuMessage.fromBytes( <br>  payload, <br>  broadcastTopicName <br>); </pre><pre name="5514" id="5514" class="graf graf--pre graf-after--pre">await this.waku.relay.send(wakuMessage);</pre><p name="5a4f" id="5a4f" class="graf graf--p graf-after--pre">Messages can be sent by waku.relay.send method. The method has only one parameter, a WakuMessage that is built from a payload and a topic name. Waku uses binary payloads. It is possible to send strings as messages, but the binary format is recommended because it’s more compact. There is a tool called <a href="https://developers.google.com/protocol-buffers" data-href="https://developers.google.com/protocol-buffers" class="markup--anchor markup--p-anchor" rel="noopener noreferrer nofollow noopener" target="_blank">Protocol Buffers</a> for defining message structures and encoding/decoding them. Our simple message format definition looks like this:</p><pre name="22c8" id="22c8" class="graf graf--pre graf-after--p">enum Type { <br>  REQUEST = 1; <br>  RESPONSE = 2; <br>} </pre><pre name="2ba4" id="2ba4" class="graf graf--pre graf-after--pre">message WakuUberMessage { <br>  Type type = 1; <br>  float lat = 2; <br>  float lng = 3; <br>  string avatarHash = 4; <br>}</pre><p name="1503" id="1503" class="graf graf--p graf-after--pre">It contains a type field that can be REQUEST (customer call a car) or RESPONSE (the driver makes an offer), a lat./long. for the geographical coordinates, and the hash of the sender’s e-mail address. The application can get the gravatar info with the e-mail hash and the private topic is also generated from it.</p><p name="1779" id="1779" class="graf graf--p graf-after--p">In nutshell, these are the important parts of the application. You can find the full code on <a href="https://github.com/TheBojda/waku-uber" data-href="https://github.com/TheBojda/waku-uber" class="markup--anchor markup--p-anchor" rel="noopener noreferrer nofollow noopener" target="_blank">GitHub</a>.</p><p name="97d1" id="97d1" class="graf graf--p graf-after--p">I know, this is a really minimal implementation of a car-sharing app, but with some improvements, it could be developed into a real application. Let’s see some of these improvements:</p><ul class="postList"><li name="0708" id="0708" class="graf graf--li graf-after--p">Real identity management. A blockchain-based identity system could ensure trust between the driver and the passenger. The messages could be encrypted and signed by the peers’ public/private keys, and the peers could be identified by 3rd party identity providers that could prove the validity of the profile data, check the driving license validity, etc.</li><li name="915b" id="915b" class="graf graf--li graf-after--li">Location-based broadcast. In the current implementation, every driver receives every request even if the passenger is at a great distance from the driver. This could be managed by more broadcast topics that are based on <a href="https://en.wikipedia.org/wiki/Geohash" data-href="https://en.wikipedia.org/wiki/Geohash" class="markup--anchor markup--li-anchor" rel="noopener noreferrer nofollow noopener" target="_blank">geohash</a>.</li></ul><p name="5a30" id="5a30" class="graf graf--p graf-after--li">As you can see when you build a decentralized application blockchain is not always the answer. Sometimes it’s worth digging deeper into the p2p stack. Peer-to-peer pubsub services like Waku can be used in many ways. You can build your decentralized Uber or decentralized Airbnb, you can build decentralized databases or your very own blockchain.</p><p name="1796" id="1796" class="graf graf--p graf-after--p">Happy coding…</p><p name="72fd" id="72fd" class="graf graf--p graf-after--p graf--trailing">This article was originally published <a href="https://hackernoon.com/decentralized-uber-heres-how-i-built-it-with-statusim-waku-and-vuejs" data-href="https://hackernoon.com/decentralized-uber-heres-how-i-built-it-with-statusim-waku-and-vuejs" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@thebojda" class="p-author h-card">Laszlo Fazekas</a> on <a href="https://medium.com/p/719b0b998387"><time class="dt-published" datetime="2021-12-03T21:26:54.332Z">December 3, 2021</time></a>.</p><p><a href="https://medium.com/@thebojda/decentralized-uber-heres-how-i-built-it-with-status-im-waku-and-vue-js-719b0b998387" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 3, 2021.</p></footer></article></body></html>